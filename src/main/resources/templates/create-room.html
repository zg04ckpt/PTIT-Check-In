<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}">
<head>
    <title layout:fragment="title">Tạo phòng</title>
</head>
<body>

    <div layout:fragment="content">

        <!-- Hưng -->
        
        <!-- Content -->
        <div class="container-lg px-lg-5" style="margin-top: 50px;">
            <div class="card card-body col-lg-8 offset-lg-2 shadow-sm">
            <div class = "font-medium text-3xl w-fit pl-[50px] w-100 text-center" style="font-size: 28px;">Tạo phòng điểm danh</div>
            <form th:object="${data}" th:action="@{/rooms/create-room}" method="post" style="margin-top: 80px;" class="ms-5">
                
                <!-- room name -->
                <div class="row mb-4">
                <label class = "col-4 text-lg font-medium">Tên phòng:</label>
                <input th:field="*{name}" type="text" placeholder="Nhập ..." class = "ps-2 col-8 ml-[0px] h-[36px] border-[1.5px] border-gray-900 rounded-sm w-[400px] focus:outline-none focus:border-green-600">
                </div>

                <!-- room owner name -->
                <div class="row mb-4">
                <label class = "col-4 text-lg font-medium">Tên chủ phòng:</label>
                <input th:field="*{createBy}" type="text" placeholder="Nhập ..." class = "ps-2 col-8 ml-[0px] h-[36px] border-[1.5px] border-gray-900 rounded-sm w-[400px] focus:outline-none focus:border-green-600">
                </div>

                <!-- list -->
                <div class="row mb-4">
                    <label class = "col-4 text-lg font-medium">Danh sách duyệt:</label>
                    <div class = "col-8 flex flex-row div4_1" style="padding-left: 0px; align-items: center;">
                        <button id="getListBtn" class = "bg-gray-400 text-white w-[120px] rounded py-1" data-bs-toggle="modal" data-bs-target="#getListDialog">Chỉnh sửa</button>
                        <p id="successLabel" class="p-0 m-0 ms-2 text-success" hidden>
                            <i class='bx bx-check'></i>
                            Lấy vị trí thành công
                        </p>
                    </div>
                </div>

                <!-- Options -->
                <div class="row mb-4">
                <label class = "col-4 text-lg font-medium">Tùy chọn:</label>
                <div class="col-8" style="padding-left: 0px;">
                    <!-- check vi tri -->
                    <div class="list flex flex-row">
                        <input type="checkbox" id="check1" class="mr-4 cursor-pointer w-[20px]" th:field="*{requireCheckLocation}">
                        <label for="check1" class="flex items-center mr-6">
                            <span class = "text-medium">Check vị trí</span>
                        </label>

                        <div class = "flex flex-row" id = "info1" style="font-size: 14px; height: 25px;" hidden>
                            <button id="check7" class = "btn btn-success btn-sm me-2 align-content-center" style="font-size: 12px;" data-bs-toggle="modal" data-bs-target="#getLocationDialog">
                                <i class='bx bxs-map text-danger'></i> Lấy mốc
                            </button>

                            <div id="rangeInput" class="d-flex align-items-center">
                                <label class="me-2">Phạm vi</label>
                                <input th:field="*{range}" min="0" type="number" placeholder="Lớp học(50m)" style="width: 120px;" class = "ps-2 h-[30px] border-[1.5px] border-gray-900 rounded-sm focus:outline-none focus:border-green-600">
                            </div>
                        </div>
                    </div>

                    <!-- Hẹn giờ mở -->
                    <div class="list flex flex-row mt-3">
                        <input type="checkbox" id="check2" class="mr-4 cursor-pointer w-[20px]">
                        <label for="check2" class="flex items-center mr-6">
                            <span class = "text-medium">Hẹn giờ mở</span>
                        </label>

                        <div class="flex-fill pe-4">
                            <div id="info2" hidden>
                                <input th:field="*{startTime}"  type="datetime-local" class="border-1 p-1 rounded-1 float-end " style="height: 25px;">
                            </div>
                            <p class="fst-italic float-end text-secondary">(Mặc định: Mở khi tạo phòng)</p>
                        </div>
                    </div>

                    <!-- Hẹn giờ đóng -->
                    <div class="list flex flex-row mt-3">
                        <input type="checkbox" id="check3" class="mr-4 cursor-pointer w-[20px]">
                        <label for="check3" class="flex items-center mr-6">
                            <span class = "text-medium">Hẹn giờ đóng</span>
                        </label>

                        <div class="flex-fill pe-4">
                            <div id="info3" hidden>
                                <input th:field="*{endTime}" type="datetime-local" class="border-1 p-1 rounded-1 float-end" style="height: 25px;">
                            </div>
                            <p class="fst-italic float-end text-secondary">(Mặc định: Đóng thủ công)</p>
                        </div>
                    </div>

                    <!-- Auto điểm danh -->
                    <div class="list flex flex-row mt-3">
                        <input th:field="*{enableAutoApproval}" type="checkbox" id="check3" class="mr-4 cursor-pointer w-[20px]">
                        <label for="check3" class="flex items-center mr-6">
                            <span class = "text-medium">Tự động điểm danh</span>
                        </label>
                    </div>

                    <!-- Ẩn -->
                    <div hidden>
                        <div id="list">
                            <div th:each="attendee, iterStat : *{attendees}">
                                <input type="text" th:field="*{attendees[__${iterStat.index}__].checkInCode}"/>
                                <input type="text" th:field="*{attendees[__${iterStat.index}__].name}"/>
                            </div>
                        </div>
                        <input type="number" th:field="*{latitude}">
                        <input type="number" th:field="*{longitude}">
                    </div>
                </div>

                <!-- Button -->
                <div class="w-100 text-center mt-5 mb-3">
                    <button class="btn btn-outline-secondary" id="backBtn" style="width: 200px;" >
                        <i class="fa-solid fa-arrow-left me-2"></i> Quay lại
                    </button>
                    <button type="submit" class="btn btn-success" style="width: 200px;">Tạo phòng</button>
                </div>
            </form>

            </div>
        </div>

        <!-- Get list dialog -->
        <div class="modal fade" id="getListDialog" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content pt-0 px-3 translate-middle-x start-50" style="width: 700px;">
                <div class="ms-2 mt-2 text-center fs-5 fw-bold">Danh sách người tham gia</div>
                <button class="btn btn-close position-absolute top-0 start-100 p-2" data-bs-dismiss="modal" style="transform: translateX(-100%);"></button>
                
                <!-- content -->
                <small id="count" class="mt-4">Số lượng: 0</small>
                <div class="row" style="font-size: 14px;">
                    <div class="col-6">
                        <table class="table" id="previewTable" th:object="${data}">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Mã điểm danh</th>
                                    <th>Tên</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- <div th:each="attendee, iterStat : *{attendees}">
                                    <tr>
                                        <td th:text="${iterStat.index + 1}"></td>
                                        <td th:text="${attendee.id}"></td>
                                        <td th:text="${attendee.name}"></td>
                                    </tr>
                                </div> -->
                            </tbody>
                        </table>
                    </div>
                    <div class="col-6">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Thứ tự cột chứa mã điểm danh:</span>
                            <input type="text" style="width: 40px;" id="idColumnInput" class="border-1 border-secondary px-1">
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span>Thứ tự cột chứa tên:</span>
                            <input type="text" style="width: 40px;" id="nameColumnInput" class="border-1 border-secondary px-1">
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span>Dòng bắt đầu:</span>
                            <input type="text" style="width: 40px;" id="startRowInput" class="border-1 border-secondary px-1">
                        </div>

                        <div class="d-flex flex-column mb-2">
                        <span class="mb-2">Tải lên file excel:</span>
                        <input type="file" accept=".xlsx, .csv" id="getListFromExcelBtn"/>
                        </div>
                    </div>
                </div>

                <div class="d-flex m-2 justify-content-center my-3">
                <button class="btn btn-info text-light btn-sm" style="width: 100px;">Hướng dẫn</button>
                <button class="ms-2 btn btn-success text-light btn-sm" id="saveBtn" style="width: 100px;" data-bs-dismiss="modal">Lưu</button>
                </div>
            </div>
            </div>
        </div>

        <!-- Get location dialog -->
        <div class="modal fade" id="getLocationDialog" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content pt-0 px-3 translate-middle-x start-50" style="width: 700px;">
                <div class="ms-2 mt-2 text-center fs-5 fw-bold">Lấy vị trí</div>
                <button class="btn btn-close position-absolute top-0 start-100 p-2" data-bs-dismiss="modal" style="transform: translateX(-100%);"></button>
                
                <!-- content -->
                <div class="row mt-4" style="font-size: 14px;">
                <div class="col-6">
                    <div class="d-flex justify-content-between">
                        <label class="align-content-center">Tùy chọn</label>
                        <select id="getLocationMethodSelect" class="border-1 border-secondary p-1">
                            <option value="1">Mặc định</option>
                            <option value="2">Lấy vị trí thủ công (Bằng GG Maps)</option>
                            <option value="3">Lấy vị trí bằng điện thoại</option>
                        </select>
                    </div>
                </div>
                <div class="col-6">
                    <!-- option 1 -->
                    <select id="locationSelect" class="w-75 mb-2 border-1 border-secondary p-1">
                        <option value="1">PTIT</option>
                    </select>
        
                    <!-- option 2 -->
                    <input id="positionInput" type="text" placeholder="Kinh độ, Vĩ độ" class="mb-2 border-1 border-secondary p-1" hidden>
                    
                    <!-- option 3 -->
                    <div id="QR" hidden>
                        <div class="d-flex">
                            <img src="" alt="" width="160px" height="160px">
                            <div class="d-flex flex-column mx-2">
                                <span class=" text-secondary fst-italic">Dùng điện thoại scan QR để lấy vị trí</span>
                                <div class="d-flex flex-column mt-3 pe-2">
                                    <span>Kết quả:</span>
                                    <p id="qrResult">[trống]</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <div class="d-flex m-2 justify-content-center my-3">
                <button class="btn btn-info text-light btn-sm" style="width: 100px;">Hướng dẫn</button>
                <button class="ms-2 btn btn-success text-light btn-sm" id="saveBtn" style="width: 100px;">Lưu</button>
                </div>
            </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="position-fixed w-100 h-100 top-0 start-0" style="z-index: 100000; background-color: rgba(128, 128, 128, 0.551);" hidden>
            <div class="card card-body p-2 position-absolute start-50 translate-middle-x" style="width: 360px; margin-top: 80px;">
                <button class="btn btn-close position-absolute end-0 top-0 m-2" onclick="notification.hidden = true"></button>
                <div class="m-0 text-center" style="font-size: 18px;">Thông báo</div>
                <hr class="mt-2 mb-2">
                <p id="noti-msg" class="text-center px-2"></p>
                
                <div class="d-flex justify-content-center mt-3">
                    <button class="btn btn-outline-success btn-sm text-center" style="width: 100px;" onclick="notification.hidden = true">OK</button>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script th:inline="javascript"> var data = /*[[${data}]]*/ {}; </script>
        <script src="/js/create-room.js"></script>
    </div>
</body>
</html>